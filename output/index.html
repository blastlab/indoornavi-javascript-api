<html>
<head>

</head>
<body>
<button disabled id="toggle10999" onclick="toggle10999()">Toggle 10999</button>
<button disabled id="drawINPolyline" onclick="drawINPolyline()">Draw INPolyline</button>
<button disabled id="removeINPolyline" onclick="removeINPolyline()">Remove INPolyline</button>
<button disabled id="drawINArea" onclick="drawINArea()"> Draw INArea</button>
<button disabled id="removeINArea" onclick="removeINArea()">Remove INArea</button>
<button disabled id="addListener" onclick="addListener()">Add listener</button>

<div id="map"></div>
</body>
<script src="indoorNavi.js"></script>
<script>
    //set poly as global variable to have access to this from every function,
    let poly = null;
    //set INArea as global variable to have access to this from every function,
    let inArea = null;
    const  points = [
      {x:480, y: 480},
      {x:1220, y: 480},
      {x:1220, y: 1220},
      {x:480, y: 1220},
      {x:750, y: 750}
    ];

    const navi = new INMap(
        'http://localhost:4200',
        'TestAdmin',
        'map',
        {
            width: 800,
            height: 600
        }
    );
    navi.load(2).then(function () {
        document.getElementById('toggle10999').removeAttribute('disabled');
        document.getElementById('drawINPolyline').removeAttribute('disabled');
        document.getElementById('removeINPolyline').removeAttribute('disabled');
        document.getElementById('drawINArea').removeAttribute('disabled');
        document.getElementById('removeINArea').removeAttribute('disabled');
    });

    // const from = new Date(2017, 10, 1);
    // const to = new Date(2017, 12, 30);
    // const report = new Report('http://localhost:90', 'TestAdmin');
    // report.getINCoordinates(2, from, to).then(function(coordinates) {
    //     console.log(coordinates);
    // });
    // report.getINAreaEvents(2, from, to).then(function(events) {
    //    console.log(events);
    // });
    //
    function toggle10999() {
        navi.toggleTagVisibility(10999);
    }

    function addListener() {
      navi.addEventListener('INArea', function(data) {

      });

      navi.addEventListener('coordinates', data => {
        console.log(data.coordinates.point);
        if (!!inArea) {
          const tagInsideINArea = inArea.isWithin(data.coordinates.point);
          if (tagInsideINArea) {
            console.log(`Tag ${data.coordinates.tagShortId} INSIDE`);
          } else {
            console.log(`Tag ${data.coordinates.tagShortId} OUTSIDE`);
          }
        }
      });
    }

    function drawINPolyline() {
      if(!!poly) {
        return;
      }
        poly = new INPolyline(navi);
        poly.ready().then(() => {
        poly.draw(points);
        poly.setLineColor('#12a3b5');
      });
    }

    function removeINPolyline() {
      if(!!poly) {
        poly.ready().then(() => {
          poly.remove();
          poly = null;
        });
      }
    }

    function drawINArea() {
      if(!!inArea){
        return;
      }
        inArea = new INArea(navi);
        inArea.ready().then(() => {
        inArea.draw(points);
        inArea.setFillColor('rgb(144,224,017)');
        inArea.setOpacity(0.5);
        console.log(inArea.isWithin({x: 740, y: 750}));
        console.log(inArea.isWithin({x: 750, y: 750}));
        document.getElementById('addListener').removeAttribute('disabled');
      });
    }

    function removeINArea() {
      if(!!inArea) {
        inArea.ready().then(() => {
          inArea.remove();
          inArea = null;
          document.getElementById('addListener').setAttribute('disabled', true);
        });
      }
    }

</script>
</html>
